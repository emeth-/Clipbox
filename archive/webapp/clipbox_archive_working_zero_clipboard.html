<html>
<head>
    <script type="text/javascript" src="md5.js"></script>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="ZeroClipboard.js"></script>
    <script>
    function htmlEscape(str)
    {
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
    }
    function clipbox(data)
    {
        /*
         data = [{"meta": "for p in pasteL... (248 chars)", "type": "text", "id": "2012-01-14_17-20-18OZJU83", "time": 1326561618},
                    {"meta": "217x111 pixels (5.0K)", "type": "image", "id": "AZPQU0_2012-01-14_17-20-35AWVVBV.png", "time": 1326561635}]
        */
        var idcounter = 0;
        tbodyHtml = "";
        for (d in data)
        {
            var retURL = "http://dl.dropbox.com/u/"+document.getElementById('dbid').value+"/.clipbox/"+data[d]['id'];
            tbodyHtml += "<tr><td>"+data[d]['type']+"</td><td>"+data[d]['id']+"</td><td>"+htmlEscape(data[d]['meta'])+"</td><td>"+data[d]['time']+"</td><td><a data-pasteurl='"+retURL+"' class='pasteurl' id='phrefid"+idcounter+"'>Copy URL</a></td><td><a target='_blank' href='"+retURL+"'>View</a></td></tr>";
            idcounter += 1;
        }
        document.getElementById('plist').innerHTML = tbodyHtml;
        
        $("a.pasteurl").each(function() {
            var clip = new ZeroClipboard.Client();
            clip.setHandCursor( true );
            clip.glue($(this).attr('id'));
            clip.setText($(this).attr('data-pasteurl'));
            clip.addEventListener('complete', function(client, text) {
                document.getElementById('msg').innerHTML = "<font color=green>URL Copied to clipboard!</font><br /><br />";
            });
        });
        
    }
    function doit()
    {
        var url = "http://dl.dropbox.com/u/"+document.getElementById('dbid').value+"/.clipbox/."+md5('Royale.'+document.getElementById('password').value);
        localStorage['authurl'] = url;
        load_db_js(url);
    }
    function load_db_js(url)
    {
        var head = document.getElementsByTagName("head")[0];
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = url;
        head.appendChild(script);
    }
    function check_for_login()
    {
        if(typeof localStorage['authurl'] === "undefined")
        {
            //do nothing
        }
        else
        {
            load_db_js(localStorage['authurl']);
        }
        
    }
    </script>
    
</head>
<body onload='check_for_login()'>
Password: <input type='password' id='password' value='blue42'><br />
Dropbox ID: <input type='text' id='dbid' value='4238738'><br />
<input type='button' onclick='doit()' value='submit'><br /><br />
    <span id='msg'></span>
    <table>
        <thead>
              <tr><th>Type</th><th>ID</th><th>Meta</th><th>Time</th><th>URL</th><th>Retrieve</th></tr>
        </thead>
        <tbody id='plist'>
            
        </tbody>
    </table>
</body>
</html>